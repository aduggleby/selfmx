---
// =============================================================================
// [...page].astro
//
// Summary: Dynamic route for standalone pages using content collections.
//
// Pages with toc: true in frontmatter get a table of contents sidebar.
// =============================================================================

import { getCollection } from "astro:content";
import BaseLayout from "../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const pages = await getCollection("pages");
  return pages.map((page) => ({
    params: { page: page.slug },
    props: { page },
  }));
}

const { page } = Astro.props;
const { Content } = await page.render();
const showToc = page.data.toc === true;
---

<BaseLayout title={`${page.data.title} - SelfMX`} description={page.data.description}>
  <div class={showToc ? "flex gap-12" : ""}>
    <div class={showToc ? "max-w-4xl flex-1" : "max-w-3xl"}>
      <section id="top" class="mb-8 md:mb-12">
        <h1 class="mb-2 text-2xl font-bold text-zinc-900 sm:text-3xl dark:text-white">{page.data.title}</h1>
      </section>

      <div
        id="content"
        class="prose prose-zinc dark:prose-invert prose-headings:font-semibold prose-a:text-green-600 dark:prose-a:text-green-400 prose-code:rounded prose-code:bg-zinc-100 prose-code:px-1 prose-code:before:content-none prose-code:after:content-none dark:prose-code:bg-zinc-800 prose-pre:bg-zinc-900 prose-pre:border prose-pre:border-zinc-800 max-w-none"
      >
        <Content />
      </div>
    </div>

    {
      showToc && (
        <aside class="hidden w-48 shrink-0 lg:block">
          <nav id="toc" class="sticky top-8">
            <h4 class="mb-3 text-xs font-semibold tracking-wider text-zinc-400 uppercase">On this page</h4>
            <ul id="toc-list" class="space-y-2 text-sm" />
          </nav>
        </aside>
      )
    }
  </div>

  {showToc && <script is:inline src="/scripts/toc.js" />}
</BaseLayout>
